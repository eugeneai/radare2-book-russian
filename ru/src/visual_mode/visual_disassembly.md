# Визуальный дизассемблер

## Навигация

Перемещение внутри дизассемблирования осуществляется с помощью клавиш со стрелками или `hjkl`. Используйте `g` для смещения непосредственно к флагу или адресу, введите его в командной строки: `[offset]>`.
Переходы по jump и call - клавиши `цифр` на клавиатуре `[0-9]` и номер справа в окне дизассемблерирования. В этом примере ввод `1` на клавиатуре будет следовать за вызовом `sym.imp.__libc_start_main` и, следовательно, устанавливать смещение на адрес этого символа.

```
0x00404894      e857dcffff     call sym.imp.__libc_start_main ;[1]
```

Вернуться на предыдущее смещение - клавиша `u`, `U` -  повторение поиска.

## `d` - определить

Клавиша `d` используется для изменения типа данных текущего блока, доступно несколько основных типов/структур, а также более продвинутый с использованием шаблона `pf` :

```
d → ...
0x004048f7      48c1e83f       shr rax, 0x3f
d → b
0x004048f7 .byte 0x48
d → B
0x004048f7 .word 0xc148
d → d
0x004048f7 hex length=165 delta=0
0x004048f7  48c1 e83f 4801 c648 d1fe 7415 b800 0000
...
```

Для улучшения удобочитаемости кода можно изменить способ представления числовых значений radare2 при дизассемблировании, по умолчанию большинство вариантов отображают числовое значение как шестнадцатеричное. Иногда надо числа представлять в десятичной, двоичной системах счисления и даже печатать пользовательские константы. Чтобы изменить формат значения используется `d`, за которым следует ` i`, затем надо выбрать, в какой системе счисления работать, это эквивалентно `ahi`:

```
d → i → ...
0x004048f7      48c1e83f       shr rax, 0x3f
d → i →  10
0x004048f7      48c1e83f       shr rax, 63
d → i →  2
0x004048f7      48c1e83f       shr rax, '?'
```

### Использование курсора для вставки/исправления...

Помните, что возможность редактировать файла доступна тлоько, если фал загружен в radare2 с использованием флага `-w`. В противном случае файл открывается в режиме "только для чтения".

При нажатии строчной буквы `c` переключается режим курсора. Когда этот режим активен, выделенный в данный момент байт (или диапазон байтов) подсвечивается.

![Курсор по адресу 0x00404896](cursor.png)

Курсор используется для выбора диапазона байтов или просто для указания конкретного байта. Курсор можно использовать для создания именованного флага по указанному смещению. Для этого установитье смещение, затем нажмите клавишу `f` и введите имя флага.
Если файл был открыт в режиме записи (флаг `-w` или команды `o+`), то курсор может перезаписывать выбранный диапазон новыми значениями. Для этого выберите диапазон байтов (при нажатии клавиш HJKL и SHIFT), затем нажмите клавишу `i` и введите шестнадцатеричные значения для новых данных. Данные будут повторяться по мере необходимости для заполнения выбранного диапазона. Например:
```
<выбрать 10 байт в визуальном режиме, используя SHIFT+HJKL>
<нажать 'i' и затем ввести '12 34'>
```
Выбранные десять байт будут изменены на "12 34 12 34 12 12...".


Визуальный ассемблер — это функция, которая обеспечивает предварительный просмотр в реальном времени при вводе новых инструкций по исправлению
в ассемблерном коде. Чтобы использовать его, найдите или поместите курсор в нужное место и нажмите клавишу «A». Чтобы ввести несколько инструкций подряд, разделите их точкой с запятой, `;`.

## XREF

Когда radare2 обнаружит XREF во время анализа, он покажет вам информацию в визуальном дизассемблерировании с помощью тега `XREF` :

```
; DATA XREF from 0x00402e0e (unk)
str.David_MacKenzie:
```

Чтобы увидеть, где вызывается эта строка, нажмите `x`, если вы хотите перейти к месту, где используются данные, затем нажмите соответствующую цифру [0-9] на клавиатуре. (Эта функциональность аналогична `axt`)

`X` соответствует обратной операции `axf`.

## Отображение аргументов функции

Чтобы включить это представление, используйте переменную конфигурации `e dbg.funcarg = true`

![funcarg](funcarg.png)

## Добавление комментария

Чтобы добавить комментарий, нажмите `;`.

## Введите другие команды

Чтобы вводить команды, используйте `:`.

## Поиск

`/`: позволяет подсвечивать строки на текущем дисплее.
`:cmd` позволяет использовать одну из команд "/?", выполняющие специализированный поиск.

## The HUDS

### The "UserFriendly HUD"

Доступ к "UserFriendly HUD" можно получить с помощью комбинации клавиш `??`. Этот HUD действует как интерактивная шпаргалка, которую можно использовать для более легкого поиска и выполнения команд. Он особенно полезен для новичков. Для опытных пользователей другие HUD-ы, более специфичные для конкретной деятельности, более полезны.

### Флаги/комментарии/функции/.. HUD"

Этот HUD отображается с помощью клавиши `_`, он показывает список всех определенных флагов и позволяет переходить к ним. С помощью клавиатуры вы можете быстро отфильтровать список до флага, который содержит определенный шаблон.

Режим ввода HUD можно закрыть с помощью ^C. Он также завершится при нажатии backspace, когда строка ввода пользователя пуста.

## Настройка дизассемблерирования

Внешний вид дизассемблирования контролируется с помощью конфигурационных ключей "asm.*", изменяемых с помощью команды `e`. Все ключи конфигурации также можно редактировать с помощью редактора визуальной конфигурации.

## Визуальный редактор конфигурации

Доступ к этому HUD можно получить с помощью клавиши `e` в визуальном режиме. Редактор позволяет легко просматривать и изменять конфигурацию radare2. Например, если вы хотите что-то изменить в дисплее дизассемблерирования, выберите `asm` из списка, перейдите к элементу, который вы хотите изменить, а затем выберите его, нажав `Enter`.
Если элемент является логической переменной, он будет переключаться, в противном случае надо будет предложено ввести новое значение.


![Выберите сначала asm](select_asm.png)


Пример переключения на псевдоразборку:

![Псевдодизассемблирование запрещено](pseudo_disable.png)


![Псевдодизассемблирование разрешено](pseudo_enable.png)

Ниже приведены некоторые примеры настроек переменных среды, связанных с дизассемблерированием.

## Примеры

#### asm.arch: Изменение архитектуры && asm.bits: Размер слова в битах на ассемблере

Просмотр списка всех дуг с помощью `e asm.arch=?`

```
e asm.arch = dalvik
0x00404870      31ed4989       cmp-long v237, v73, v137
0x00404874      d15e4889       rsub-int v14, v5, 0x8948
0x00404878      e24883e4       ushr-int/lit8 v72, v131, 0xe4
0x0040487c      f0505449c7c0   +invoke-object-init-range {}, method+18772 ;[0]
0x00404882      90244100       add-int v36, v65, v0
```

```
e asm.bits = 16
0000:4870      31ed           xor bp, bp
0000:4872      49             dec cx
0000:4873      89d1           mov cx, dx
0000:4875      5e             pop si
0000:4876      48             dec ax
0000:4877      89e2           mov dx, sp
```
Последняя операция также может быть выполнена с помощью `&` в визуальном режиме.


#### asm.pseudo: Включить псевдосинтакс

```
e asm.pseudo = true
0x00404870      31ed           ebp = 0
0x00404872      4989d1         r9 = rdx
0x00404875      5e             pop rsi
0x00404876      4889e2         rdx = rsp
0x00404879      4883e4f0       rsp &= 0xfffffffffffffff0
```

#### asm.syntax: Выбор синтаксиса дизассемблерирования (intel, att, masm...)

```
e asm.syntax = att
0x00404870      31ed           xor %ebp, %ebp
0x00404872      4989d1         mov %rdx, %r9
0x00404875      5e             pop %rsi
0x00404876      4889e2         mov %rsp, %rdx
0x00404879      4883e4f0       and $0xfffffffffffffff0, %rsp
```

#### asm.describe: Показать описание оп-кода

```
e asm.describe = true
0x00404870  xor ebp, ebp   ; logical exclusive or
0x00404872  mov r9, rdx    ; moves data from src to dst
0x00404875  pop rsi        ; pops last element of stack and stores the result in argument
0x00404876  mov rdx, rsp   ; moves data from src to dst
0x00404879  and rsp, -0xf  ; binary and operation between src and dst, stores result on dst
```


