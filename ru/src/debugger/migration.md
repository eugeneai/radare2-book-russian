# Переход с IDA, GDB и WinDBG

## Как запустить программу с помощью отладчика
##

`r2 -d /bin/ls` - запуск в режиме отладки => [[видео](http://asciinema.org/a/12022)].

## Как присоединиться/отсоединиться от исполняющегося процесса? (gdb -p)
##

`r2 -d <pid>` - присоединившихся к процессу,

`r2 ptrace://pid` - подсоединиться к процессу, но только для io (не используется бэкенд отладчика),

`[0x7fff6ad90028]> o-225` - закрыть fd=225 (перечень из `o~[1]:0`),

`r2 -D gdb gdb://localhost:1234` - подключиться к серверу gdb.

## Как установить аргументы/переменные среды/загрузить динамическую библиотеку в сеансе отладки radare

Используйте `rarun2` (`libpath=$PWD:/tmp/lib`, `arg2=hello`, `setenv=FOO=BAR` ...), инструкции - `rarun2 -h` / `man rarun2`.

## Как запускать скрипты в radare2 ?

`r2 -i <scriptfile> ...` - запуск скрипта **после** загрузки файла => [[video](http://asciinema.org/a/12020)],

`r2 -I <scriptfile> ...` - запуск скрипта **до** загрузки файла,

`r2 -c $@ | awk $@`  - пропустить через awk для получения asm-кода функции => [[link](http://sprunge.us/dEOK)],

`[0x80480423]> . scriptfile` - интерпретировать файл => [[video](http://asciinema.org/a/12017)],

`[0x80480423]> #!c` - вход в C-шный repl  (см. `#!` перечень доступных плагинов RLang)  => [[video](http://asciinema.org/a/12019)], все должно быть сделано в одной строке, можно передать файл.c в качестве аргумента.

Если нужен `#!python` и другие варианты, просто соберите модуль [radare2-bindings](https://github.com/radareorg/radare2-bindings).

## Как показать исходный код подобно gdb?

`CL @ sym.main` - данная функция еще недостаточно стабилизирована.

# сочетания клавиш

| Команда | IDA Pro | Программа radare2 | r2 (визуальный режим) | GDB | WinDbg |
| ------------- | ------------- |----------------|------------------|-----|-----|
| **Анализ** |               |                |
| Анализ всех данных и кода | Автоматически запускается при открытии бинарника | `aaa` или `-A` (`aaaa` или `-AA` для запуска новых экспериментальных видов анализа) | отсутствует | отсутствует | отсутствует |
| **Управление интерфейсом** |               |                |
| переход по внешней ссылке | `x` | `axt` | `x` | отсутствует | отсутствует |
| переход с внешней ссылки | `ctrl + j` | `axf` | `X` | отсутствует | отсутствует |
| xref в граф | ? | `agt [offset]` | ? | отсутствует | отсутствует |
| xref из графа | ? | `agf [offset]` | ? | отсутствует | отсутствует |
| список функций | `alt + 1` | `afl;is` | `t` | отсутствует | отсутствует |
| Листинг | `alt + 2` | `pdf` | `p` | отсутствует | отсутствует |
| режим hex | `alt + 3` | `pxa` | `P` | отсутствует | отсутствует |
| импорты | `alt + 6` | `ii` | `:ii` | отсутствует | отсутствует |
| экспорты | `alt + 7` | `is~FUNC` | ? | отсутствует | отсутствует |
| переход по jmp/call | `enter` | `s offset` | `enter` или `0`-`9` | отсутствует | отсутствует |
| отмена seek | `esc` | `s-` | `u` | отсутствует | отсутствует |
| вернуть прежний seek | `ctrl+enter` | `s+` | `U` | отсутствует | отсутствует |
| показать граф управления | `space` | `agv` | `V` | отсутствует | отсутствует |
| **Правка** |               |                |
| переименование | `n` | `afn` | `dr` | отсутствует | отсутствует |
| режим графа управления | `space` | `agv` | `V` | отсутствует | отсутствует |
| определить как блок данных | `d` | `Cd [size]` | `dd`,`db`,`dw`,`dW` | отсутствует | отсутствует |
| определить как блок кода | `c` | `C- [size]` | `d-` or `du` | отсутствует | отсутствует |
| определить как неопределеный блок | `u` | `C- [size]` | `d-` or `du` | отсутствует | отсутствует |
| определить как строку | `A` | `Cs [размер]` | `ds` | отсутствует | отсутствует |
| определить как структуру | `Alt+Q` | `Cf [размер]` | `dF` | отсутствует | отсутствует |
| **Отладчик** |               |                |                |
| начать / продолжить процесс | `F9` | `dc` | `F9` | `r` и `c` | `g` |
| завершить процесс | `Ctrl+F2` | `dk 9` | ? | `kill` | `q` |
| отсоединится | `?` | `o-` | ? | `detach` |
| step into | `F7` | `ds` | `s` | `n` | `t` |
| step into 4 инструкции | ? | `ds 4` | F7 | `n 4` | `t 4` |
| step over | `F8` | `dso` | `S` | `s` | `p` |
| step until указанный адрес | ? | `dsu <addr>` | ? | `s` | `g <addr>` |
| исполнять до оператора return | `Ctrl+F7` | `dcr` | ? | `finish` | `gu` |
| выполнять до курсора | `F4` | [#249](https://github.com/radareorg/radare2/issues/249) | [#249](https://github.com/radareorg/radare2/issues/249) | отсутствует | отсутствует |
| показать стек | `?` | `dbt` | ? | `bt` |
| показать регистр | в окне регистров | `dr all` | автоматом в визуальном режиме | `info registers` | `r` |
| распечатать eax | в окне регистров | `dr?eax` | автоматом в визуальном режиме | `info registers eax` | `r rax` |
| показать старое состояние всех регистров | ? | `dro` | ? | ? | ? |
| показать что по function addr + N | ? | `afi $$` - показать информацию о функции в текущем смещении (`$$`) | ? | ? | ? |
| отображать состояние кадра | ? | `pxw rbp-rsp@rsp` | ? | `i f` | ? |
| исполнять до тех пор, пока условие не станет истинным | ? | `dsi` | ? | ? | ? |
| присвоить значение регистру | ? | `dr rip=0x456` | ? | `set $rip=0x456` | `r rip=456` |
| **Дизассемблирование** |            |                |                  |
| дизассемблирование далее | отсутствует | `pd` | `Vp` | `disas` | `uf`, `u` |
| дизассемблировать N инструкций | отсутствует | `pd X` | Vp | x/<N>i | `u <addr> LX` |
| дизассемблировать N в обратном направлении | отсутствует | `pd -X` | `Vp` | `disas <a-o> <a>` | `ub` |
| **Информация о секциях** |            |                |                  |
| секции/регионы | Menu sections | `iS` или `S` (добавить j для json) | отсутствует | maint info sections | !address |
| **Загрузка файла символов** |            |                |                  |
| секции/регионы | `pdb menu` | `asm.dwarf.file`, `pdb.XX`) | отсутствует | add-symbol-file | r |
| **Стек** |            |                |                  |
| стек | отсутствует | `dbt` | отсутствует | `bt` | `k` |
| стек в Json | отсутствует | `dbtj` | отсутствует |  |
| частичное отображение стека (внутренняя часть) | отсутствует | `dbt` (`dbg.btdepth` `dbg.btalgo`) | отсутствует | bt <N> | k <N> |
| частичное отображение стека (внешняя часть) | отсутствует | `dbt` (`dbg.btdepth` `dbg.btalgo`) | отсутствует | bt -<N> |
| стеки всех нитей | отсутствует | `dbt@t` | отсутствует | `thread apply all bt` | `~* k` |
| **Точки останова** |            |                |                  | |
| список точек останова | `Ctrl+Alt+B` | `db` | ? | `info breakpoints` | `bl` |
| добавление точки останова | `F2` | `db [offset]` | `F2` | `break` | `bp` |
| **Нити** |        |                |                  |                  |
| Переключится в нить | Thread menu | `dp` | отсутствует | `thread <N>` | `~<N>s` |
| **Фремы стека** |        |                |                  |                  |
| номера фреймов | отсутствует | `?` | отсутствует | `any bt command` | `kn` |
| выбор фрейма | отсутствует | `?` | отсутствует | `frame` | `.frame` |
| **Формальные/Локальные переменные** |        |                |                  |                  |
| отображение формальных параметров | отсутствует | `afv` | отсутствует | `info args` | `dv /t /i /V` |
| отображение локальных параметров | отсутствует | `afv` | отсутствует | `info locals` | `dv /t /i /V` |
| сохранить параметры/локальные объекты в json | отсутствует | `afvj` | отсутствует | `info locals` | `dv /t /i /V` |
| список адресов, где есть доступ к переменным (R/W) | отсутствует | `afvR/afvW` | отсутствует | `?` | `?` |
| **Поддержание проекта** |        |                |                  |
| открыть проект |                 | `Po [file]` |                  | ? |
| сохранить проект | automatic | `Ps [file]` |                  | ? |
| информация о проекте |    | `Pi [file]` |                  | ? |
| **Разное** |               |                |             |
| Дамп массива в виде символов | отсутствует | `pc?` (json, C, char, etc.) | Vpppp | x/<N>bc | db |
| настройки | option menu | `e?` | `e` |
| поиск | search menu | `/?` | выбор зоны курсором `c` затем `/` | | `s` |

## Эквивалент команды gdb "set-follow-fork-mode"
Делается с помощью двух команд:

1. `dcf` - пока не произойдет форк,
2. затем используйте `dp` - выбор процесса для отладки.

# Общие функции
- r2 принимает подписи FLIRT,
- r2 подключается к GDB, LLVM и WinDbg,
- r2 может писать/исправлять загруженный файл,
- в r2 встроены fortune [s], пасхальные [/s] и стальные яйца,
- r2 выполняет загрузку слепков (core dump) файлов ELF и MDMP (минидампы Windows).
