# Команды графа управления

При анализе данных обычно удобно иметь разные способы их представления, чтобы получить новый обобщенный взгляд, позволяющий аналитику понять, как взаимодействуют различные части программы. Представление базовых блоков (далее в разделе, просто блоков), вызовов функций, строковых ссылок в виде графов (графов управления) показывает очень четкое представление этой информации. Radare2 поддерживает различные типы графов, доступные с помощью команд, начинающихся с `ag`:

```
[0x00005000]> ag?
|Usage: ag<graphtype><format> [addr]
| Команды графов:
| aga[format]             Граф ссылок данных
| agA[format]             Глобальный граф ссылок данных
| agc[format]             Граф функций
| agC[format]             Глобальный граф вызовов функций
| agd[format] [fcn addr]  Граф различий
| agf[format]             Граф базовых блоков функции
| agi[format]             Граф импортов
| agr[format]             Граф ссылок
| agR[format]             Глобальный граф ссылок
| agx[format]             Граф перекресных ссылок
| agg[format]             Граф общего вида, настраиваемый
| ag-                     Очистить граф общего вида
| agn[?] title body       Добавить узел в настраиваемый граф
| age[?] title1 title2    Добавить дугу в настраиваемый граф

Форматы вывода:
| <blank>                 Псевдографика Ascii
| *                       Команды r2
| d                       Формат dot Graphviz-а
| g                       Формат gml (Graph Modelling Language)
| j                       JSON ('J' для форматированного дизассемблирования)
| k                       Ключ-значение SDB
| t                       Крошечный ascii-art
| v                       Интерактивный ascii-art
| w [path]                Записать в файл или показать на экране изображение (смотрите graph.gv.format и graph.web)
```

Структура команд следующая: `ag <graph type> <output format>`. Например, `agid` отображает граф импорта в точечном формате, а `aggj` выводит граф в формате JSON. Вот краткое описание для каждого доступного формата вывода:

### Ascii Art ** (например, `agf`)

Выводит граф на stdout, используя ASCII-art для представления блоков и ребер. _Предупреждение: отображение больших графов в stdout может оказаться вычислительно дорогостоящим, r2 может перестать реагировать на команды в течение некоторого времени._ В случае сомнений, используйте интерактивное представление (рассматривается ниже).

### Интерактивный Ascii-art (например, `agfv`)

Отображает граф в ASCII в интерактивном представлении, аналогичном `VV`, позволяющее перемещать экран, увеличивать/уменьшать, ...

### Крошечный Ascii-art (например, `agft`)

Отображает график ASCII непосредственно в stdout в этом режиме (что аналогично достижению максимального уровня уменьшения масштаба в интерактивном представлении).

### Graphviz dot (например, `agfd`)

Печатает исходный код dot, представляющий граф, интерпретируемый программами типа [graphviz](https://graphviz.gitlab.io/download/) или онлайн-вьюверами, подобными [этому](http://www.webgraphviz.com/).

### JSON (например, `agfj`)

Выводит строку JSON, представляющую граф.

- В случае формата `f` (блоки функции), будет отображена подробно информация о функции, ее дизассемблирование (используйте формат `J` для форматированного дизассемблирования).

- Во всех остальных случаях он будет содержать только основную информацию об узлах графа (идентификатор, заголовок, тело и ребра).

### Язык моделирования графа (например, `agfg`)

Выводит исходный код GML, представляющий граф, интерпретируемый, например, программой [yEd](https://www.yworks.com/products/yed/download)

### Ключ-значение SDB (например, `agfk`)

Печатает строки "ключ-значение", представляющие граф, сохраненный в sdb (строковая база данных radare2).

### Пользовательские команды R2 для графа (например, `agf*`)

Печатает команды r2, которые воссоздают нужный граф. Команды для построения графа: `agn [title] [body]` - добавление узла и `age [title1] [title2]` - добавление ребра.
Поле `[body]` можно представлять в base64 для включения специального форматирования (например, новых строк).

Чтобы выполнять напечатанные команды, можно добавить точку к команде (`.agf*`).

### Веб / изображение (например, `agfw`)

Radare2 преобразует график в формат dot. Программа `dot` преобразует его в `.gif`-изображение, а затем результат можно просмотреть в вашей операционной системе (`xdg-open`, `open`, `eog`, `xnview`, ...).

Расширение файла для изображения задается с помощью переменной `конфигурации graph.extension`. Доступны расширения `png, jpg, gif, pdf, ps`.

_Примечание: для особенно больших графиков рекомендуемым расширением является `svg`, так как оно будет производить изображения гораздо меньшего размера._

Если переменная конфигурации `graph.web` включена, radare2 попытается отобразить график с помощью браузера (_эта функция является экспериментальной и незавершенной, отключена по умолчанию._)
