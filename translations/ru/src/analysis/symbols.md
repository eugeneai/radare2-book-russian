# Символы

Radare2 автоматически анализирует доступные разделы импорта и экспорта в двоичном файле, он также может загружать отладочную информацию, если таковая будет найдена. Поддерживаются два основных формата: DWARF и PDB (для двоичных файлов Windows). Обратите внимание, что, в отличие от многих инструментов, raide2 не использует Windows API для анализа PDB-файлов, поэтому их можно загружать на любой другой поддерживаемой платформе, включая Линукс или OS Х.

Отладочная информация DWARF загружается автоматически по умолчанию, поскольку обычно она сохраняется прямо в исполняемом файле. PDB используется по-другому, так как он хранится как отдельный двоичный файл. Одним из распространенных сценариев является анализ файла из дистрибутива Windows. В этом случае все файлы PDB доступны на сервере Microsoft, который по умолчанию есть в настройках. Посмотреть все параметры pdb в радаре2:

```
pdb.autoload = 0
pdb.extract = 1
pdb.server = https://msdl.microsoft.com/download/symbols
pdb.useragent = Microsoft-Symbol-Server/6.11.0001.402
```

Используя переменную `pdb.server` можно изменить адрес, по которому Radare2  будет загружать PDB по известному GUID, хранящемуся в заголовке исполняемого файла. Можно использовать несколько серверов, предоставляющих символы, разделив их URL-ы точкой с запятой:
```
e pdb.server = https://msdl.microsoft.com/download/symbols;https://symbols.mozilla.org/
```
В Windows можно также использовать общие сетевые пути (UNC-пути) в качестве серверов символов. Обычно нет особых причин изменять значение по умолчанию `pdb.useragent`, но кто знает...? Поскольку файлы PDB хранятся на сервере в виде CAB-архивов, переменная `pdb.extract=1` настраивает ядро на автоматическую их распаковку. Обратите внимание, что для автоматической загрузки вам нужна утилиты операционной системы «*cabextract*» и *wget/curl*.

Иногда нужно грузить символы не в radare2, а в других инструментах, например в rabin2:

```
 -P              показать отладочную/pdb информацию
 -PP             загрузить файл pdb
```

Здесь `-PP` автоматически загружает pdb для выбранного двоичного файла, используя настройки в `pdb.*`. Флаг `-P` сбросит дамп файла PDB, его можно открыть и посмотреть хранящихся в нем символы. Помимо основного сценария, простого открытия файла, информацией PDB можно дополнительно манипулировать при помощи команды `id`:

```
[0x000051c0]> id?
|Usage: id Отладочная информация
| Ражим вывода:
| '*'              Выводить в виде команд radare
| id               Строки исходного кода
| idp [file.pdb]   Загрузить информацию о файле pdb
| idpi [file.pdb]  Показать информацию о файле pdb
| idpd             Загрузить pdb-файл с удаленного сервера
```

Здесь команда `idpi` делает то же самое, что и `rabin2 -P`. Команду `idp` также можно использовать не только во время статического анализа, но и в режиме отладки, даже если отладка ведется при помощи WinDbg.

Для упрощения использования PDB, особенно в процессе анализа двоичных файлов с большим количеством связанных DLL, radare2 автоматически загружает все необходимые PDB, нужно просто установить `e pdb.autoload=true`. Затем, при открытии какого-либо файла в режиме отладки в Windows, используя `r2 -d файл.exe` или ` р2 -d 2345` (присоединиться к pid 2345), все связанные PDB-файлы будут автоматически загружены.

Загрузка информации в формате DWARF полностью автоматизирована. Не нужно запускать какие-либо команды/изменять параметры:

```
r2 `which rabin2`
[0x00002437 8% 300 /usr/local/bin/rabin2]> pd $r
0x00002437  jne 0x2468                  ;[1]
0x00002439  cmp qword reloc.__cxa_finalize_224, 0
0x00002441  push rbp
0x00002442  mov rbp, rsp
0x00002445  je 0x2453                   ;[2]
0x00002447  lea rdi, obj.__dso_handle   ; 0x207c40 ; "@| "
0x0000244e  call 0x2360                 ;[3]
0x00002453  call sym.deregister_tm_clones ;[4]
0x00002458  mov byte [obj.completed.6991], 1 ; obj.__TMC_END__ ; [0x2082f0:1]=0
0x0000245f  pop rbp
0x00002460  ret
0x00002461  nop dword [rax]
0x00002468  ret
0x0000246a  nop word [rax + rax]
;-- entry1.init:
;-- frame_dummy:
0x00002470  push rbp
0x00002471  mov rbp, rsp
0x00002474  pop rbp
0x00002475  jmp sym.register_tm_clones  ;[5]
;-- blob_version:
0x0000247a  push rbp                    ; ../blob/version.c:18
0x0000247b  mov rbp, rsp
0x0000247e  sub rsp, 0x10
0x00002482  mov qword [rbp - 8], rdi
0x00002486  mov eax, 0x32               ; ../blob/version.c:24 ; '2'
0x0000248b  test al, al                 ; ../blob/version.c:19
0x0000248d  je 0x2498                   ;[6]
0x0000248f  lea rax, str.2.0.1_182_gf1aa3aa4d ; 0x60b8 ; "2.0.1-182-gf1aa3aa4d"
0x00002496  jmp 0x249f                  ;[7]
0x00002498  lea rax, 0x000060cd
0x0000249f  mov rsi, qword [rbp - 8]
0x000024a3  mov r8, rax
0x000024a6  mov ecx, 0x40               ; section_end.ehdr
0x000024ab  mov edx, 0x40c0
0x000024b0  lea rdi, str._s_2.1.0_git__d___linux_x86__d_git._s_n ; 0x60d0 ; "%s 2.1.0-git %d @ linux-x86-%d git.%s\n"
0x000024b7  mov eax, 0
0x000024bc  call 0x2350                 ;[8]
0x000024c1  mov eax, 0x66               ; ../blob/version.c:25 ; 'f'
0x000024c6  test al, al
0x000024c8  je 0x24d6                   ;[9]
0x000024ca  lea rdi, str.commit:_f1aa3aa4d2599c1ad60e3ecbe5f4d8261b282385_build:_2017_11_06__12:18:39 ; ../blob/version.c:26 ; 0x60f8 ; "commit: f1aa3aa4d2599c1ad60e3ecbe5f4d8261b282385 build: 2017-11-06__1
0x000024d1  call sym.imp.puts           ;[?]
0x000024d6  mov eax, 0                  ; ../blob/version.c:28
0x000024db  leave                       ; ../blob/version.c:29
0x000024dc  ret
;-- rabin_show_help:
0x000024dd  push rbp                    ; .//rabin2.c:27
```

Как видите, загружаются имена функций и информация об исходной строке.
