# Программа rafind2

Rafind2 — это командная строка библиотеки `r_search`. Она позволяет искать строки, последовательности байтов с двоичными масками и т.д.

```
$ rafind2 -h
Usage: rafind2 [-mXnzZhqv] [-a align] [-b sz] [-f/t from/to] [-[e|s|S] str] [-x hex] -|file|dir ..
 -a [align] принимать только выровненные хиты
 -b [size]  установить размер блока
 -e [regex] поиск соответствий regex (может быть использовано несколько раз)
 -f [from]  начать поиск с адреса 'from'
 -h         показать это сообщение
 -i         идентифицировать тип файла (r2 -nqcpm файл)
 -j         выводить в формате JSON
 -m         поиск магических последовательностей, идентификация типа файла
 -M [str]   задать бинарную маску, применяемую к ключевым словам
 -n         не останавливаться при наличии ошибок чтения
 -r         вывести результат в виде команд radare
 -s [str]   поиск заданной строки (может быть использовано несколько раз)
 -S [str]   поиск заданной wide-строки (может быть использовано несколько раз), предполагается кодировка UTF-8.
 -t [to]    остановить поиск на адресе 'to'
 -q         тихий режим, не показывать заголовки в результатах (имена файлов), совпадающий контент (по умолчанию для поиска в одном файле)
 -v         напечатать версию и выйти
 -x [hex]   поиск шнадцатеричных строк (909090) (может быть использовано несколько раз)
 -X         выводить результат в виде шестнадцатеричного дампа
 -z         поиск строк, заканчивающихся нулем
 -Z         показывать строки для каждого хита
```

Вот как его использовать: сначала найдем "lib" внутри двоичного файла `/bin/ls`.
```
$ rafind2 -s lib /bin/ls
0x5f9
0x675
0x679
...
$
```
Обратите внимание, что выходные данные довольно минималистичны и показывают смещения там, где находится строка `lib`. Можно использовать этот вывод для подачи других инструментов.

Результаты подсчета:

```
$ rafind2 -s lib /bin/ls | wc -l
```

Отображение результатов с контекстом:

```
$ export F=/bin/ls
$ for a in `rafind2 -s lib $F` ; do \
    r2 -ns $a -qc'x 32' $F ; done
0x000005f9  6c69 622f 6479 6c64 .. lib/dyld........
0x00000675  6c69 622f 6c69 6275 .. lib/libutil.dyli
0x00000679  6c69 6275 7469 6c2e .. libutil.dylib...
0x00000683  6c69 6200 000c 0000 .. lib......8......
0x000006a5  6c69 622f 6c69 626e .. lib/libncurses.5
0x000006a9  6c69 626e 6375 7273 .. libncurses.5.4.d
0x000006ba  6c69 6200 0000 0c00 .. lib.......8.....
0x000006dd  6c69 622f 6c69 6253 .. lib/libSystem.B.
0x000006e1  6c69 6253 7973 7465 .. libSystem.B.dyli
0x000006ef  6c69 6200 0000 0000 .. lib......&......
```

Rafind2 также может быть использован в качестве замены `file` для идентификации mimetype файла с помощью внутренней базы данных магических последовательностей radare2.

```
$ rafind2 -i /bin/ls
0x00000000 1 Mach-O
```

Также утилита работает как замена `strings` аналогично rabin2 -z, но без анализа заголовков и двоичных разделов.

```
$ rafind2 -z /bin/ls| grep http
0x000076e5 %http://www.apple.com/appleca/root.crl0\r
0x00007ae6 https://www.apple.com/appleca/0
0x00007fa9 )http://www.apple.com/certificateauthority0
0x000080ab $http://crl.apple.com/codesigning.crl0
```
