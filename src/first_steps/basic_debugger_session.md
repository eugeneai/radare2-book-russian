# Основные команды отладчика

Запуск радара в режиме отладки осуществляется при помощи флага `-d` в командной строке операционной системы. Обычно производится запуск новой программы, указывая ее имя и параметры, можно также и присоединиться к выполняющемуся процессу, указав его PID.

```
$ pidof mc
32220
$ r2 -d 32220
$ r2 -d /bin/ls
$ r2 -a arm -b 16 -d gdb://192.168.1.43:9090
...
```

Во втором случае отладчик создаст дочерний процесс и загрузит в него программу `ls` для отладки.

Программа остановится в момент загрузки `ld.so` динамическим компоновщиком. В этот момент точка входа еще не будет видна и разделяемые библиотеки тоже.

Переопределить такое функционирование можно, задав другой адрес для останова - адрес точки входа по ее имени. Делается это добавлением команды радара
`e dbg.bep=entry` или `e dbg.bep=main` в ваш startup-сценарий, обычно он находится в файле `~/.config/radare2/radare2rc`.

Другой способ - запустить продолжения исполнения до определенного адреса - команда `dcu`. Команда означает, что «отладку продолжать до тех пор, пока» (debug continue until) не будет достигнут адрес, где нужно остановить исполнение. Например:

```
dcu main
```

Имейте в виду, что определенные вредоносные или другие замороченные программы могут выполнять некоторый код до запуска `main()`, что не даст возможности контролировать вам исполнение этого кода. (Также и конструкторы программ и TLS-инициализации)

Ниже приведен список наиболее распространенных команд, используемых с отладчиком:
```
> d?            ; показать подсказку по командам отладчика
> ds 3          ; сделать три шага (step)
> db 0x8048920  ; установить точку останова (set breakpoint)
> db -0x8048920 ; удаление точки останова
> dc            ; продолжить исполнение процесса (continue)
> dcs           ; продолжить исполнение до запуска системного вызова (continue until syscall)
> dd            ; проводить манипуляции с файловыми дескрипторами
> dm            ; показать карты процесса (show process maps)
> dmp A S rwx   ; поменять ограничения для страницы по адресу A размером S
> dr eax=33     ; присвоить значение регистру (set register value). eax = 33
```

Есть еще один вариант отладки в радаре, который проще - использование визуального режима.

При его использовании не нужно ни запоминать команды, ни держать в уме состояние программы.

Чтобы перейти в режим визуального отладчика, используйте `Vpp`:

```
[0xb7f0c8c0]> Vpp
```

Начальное вид экрана в визуальном режиме представляет собой шестнадцатеричный вид текущего счетчика отлаживаемой программы (например, EIP для архитектуры x86).
Нажатие `p` переключает между разными представлениями в визуальном режиме.
Можно нажимать `p` и `P` для смены режимов различных вариантов визуализации.
Используйте F7 или `s` чтобы войти внутрь функции и F8 или `S` для перешагивания через текущую инструкцию.
Ключ `c` позволяет переключаться в режим курсора. В этом режиме можно выделять диапазоны байтов,
например, чтобы потом перезаписать их nop-пами. Установка точки останова - клавиша `F2`.

В визуальном режиме можно вводить обычные команды радара, добавляя к ним префикс `:`.
Например, чтобы сбросить один блок содержимого памяти по адресу в регистре ESI:
```
<Нажать ':'>
x @ esi
```
Получение справки по визуальному режиму - клавиша `?`. Для прокрутки экрана справки используются стрелки. Если надо выйти из режима справки, используйте клавишу `q`.

Часто используемая команда - `dr`, она используется для чтения или установки значений регистров общего назначения.
Еще есть более компактное представления значения регистра - команда `dr=`.
Можно манипулировать также аппаратными регистрами, расширенными регистрами, регистрами для чисел с плавающей запятой.

